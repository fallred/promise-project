<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>4-2-thenable</title>
</head>

<body>
  <script>
    function notifyMessage(message, options, callback) {
      if (Notification && Notification.permission === 'granted') {
          var notification = new Notification(message, options);
          callback(null, notification);
      } else if (Notification.requestPermission) {
          Notification.requestPermission(function (status) {
              if (Notification.permission !== status) {
                  Notification.permission = status;
              }
              if (status === 'granted') {
                  var notification = new Notification(message, options);
                  callback(null, notification);
              } else {
                  callback(new Error('user denied'));
              }
          });
      } else {
          callback(new Error('doesn\'t support Notification API'));
      }
    }
    function notifyMessageAsPromise(message, options) {
        return new Promise(function (resolve, reject) {
            notifyMessage(message, options, function (error, notification) {
                if (error) {
                    reject(error);
                } else {
                    resolve(notification);
                }
            });
        });
    }
    // 返回 `thenable`
    function notifyMessageAsThenable(message, options) {
        return {
            'then': function (resolve, reject) {
                notifyMessage(message, options, function (error, notification) {
                    if (error) {
                        reject(error);
                    } else {
                        resolve(notification);
                    }
                });
            }
        };
    }
    
    // 运行示例1
    notifyMessageAsPromise("Hi!").then(function (notification) {
        console.log(notification);// 通知对象
    }).catch(function(error){
        console.error(error);
    });
    // 运行示例2
    Promise.resolve(notifyMessageAsThenable("message")).then(function (notification) {
        console.log(notification);// 通知对象
    }).catch(function(error){
        console.error(error);
    });
  </script>
</body>
</html>